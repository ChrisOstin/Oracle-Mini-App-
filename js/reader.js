    let currentBook = null;let currentPage = 0;let fontSize = 16;let readerTheme = 'dark';const books = { 'babylon': { title: '–°–∞–º—ã–π –ë–æ–≥–∞—Ç—ã–π –ß–µ–ª–æ–≤–µ–∫ –≤ –í–∞–≤–∏–ª–æ–Ω–µ', file: 'books/babylon.txt', pages: [] }, 'rich_dad': { title: '–ë–æ–≥–∞—Ç—ã–π –ø–∞–ø–∞ - –ë–µ–¥–Ω—ã–π –ø–∞–ø–∞', file: 'books/rich_dad.txt', pages: [] }, 'cashflow_quadrant': { title: '–ö–≤–∞–¥—Ä–∞—Ç –¥–µ–Ω–µ–∂–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞', file: 'books/cashflow_quadrant.txt', pages: [] }};async function loadBook(bookId) { try { const response = await fetch(books[bookId].file); const text = await response.text(); const lines = text.split('\n'); const pageSize = 20; for (let i = 0; i < lines.length; i += pageSize) { books[bookId].pages.push(lines.slice(i, i + pageSize).join('\n')); } } catch (error) { console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–Ω–∏–≥–∏:', error); books[bookId].pages = ['[–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–Ω–∏–≥–∏]']; }}function showPage() { if (!currentBook) return; const bookPages = books[currentBook].pages; if (bookPages.length === 0) return; document.getElementById('reader-text').textContent = bookPages[currentPage]; document.getElementById('page-info').textContent = `${currentPage + 1}/${bookPages.length}`; localStorage.setItem(`book_${currentBook}_page`, currentPage);}async function openBook(bookId) { if (!books[bookId]) return; currentBook = bookId; document.getElementById('books-list').classList.add('hidden'); document.getElementById('reader-content').classList.remove('hidden'); if (books[bookId].pages.length === 0) { await loadBook(bookId); } const lastPage = localStorage.getItem(`book_${bookId}_page`) || 0; currentPage = parseInt(lastPage); showPage(); if (window.currentUser) { if (!window.currentUser.booksRead) window.currentUser.booksRead = []; if (!window.currentUser.booksRead.includes(bookId)) { window.currentUser.booksRead.push(bookId); window.currentUser.stats.books = window.currentUser.booksRead.length; localStorage.setItem('oracle_user', JSON.stringify(window.currentUser)); } }}function nextPage() { if (!currentBook) return; if (currentPage < books[currentBook].pages.length - 1) { currentPage++; showPage(); }}function prevPage() { if (!currentBook) return; if (currentPage > 0) { currentPage--; showPage(); }}function changeFontSize(delta) { fontSize += delta; if (fontSize < 12) fontSize = 12; if (fontSize > 24) fontSize = 24; document.getElementById('reader-text').style.fontSize = fontSize + 'px'; document.getElementById('font-size').textContent = fontSize + 'px'; localStorage.setItem('reader_font_size', fontSize);}function toggleReaderTheme() { readerTheme = readerTheme === 'dark' ? 'light' : 'dark'; const readerText = document.getElementById('reader-text'); if (readerTheme === 'light') { readerText.classList.add('light'); } else { readerText.classList.remove('light'); } localStorage.setItem('reader_theme', readerTheme);}function backToBooks() { currentBook = null; document.getElementById('books-list').classList.remove('hidden'); document.getElementById('reader-content').classList.add('hidden');}export function openReader() { const modal = document.createElement('div'); modal.className = 'modal'; modal.id = 'reader-modal'; const savedFontSize = localStorage.getItem('reader_font_size'); const savedTheme = localStorage.getItem('reader_theme'); if (savedFontSize) fontSize = parseInt(savedFontSize); if (savedTheme) readerTheme = savedTheme; modal.innerHTML = ` <div class="modal-content reader-modal"> <div class="modal-header"> <h2>üìö –ß–∏—Ç–∞–ª–∫–∞</h2> <button class="close-btn" onclick="window.closeModal('reader')">&times;</button> </div> <div class="modal-body" id="reader-body"> <div class="books-list" id="books-list"> ${Object.entries(books).map(([id, book]) => ` <div class="book-item" data-book="${id}"> <span class="book-icon">üìñ</span> <span class="book-title">${book.title}</span> </div> `).join('')} </div> <div id="reader-content" class="reader-content hidden"> <div class="reader-controls"> <button onclick="window.changeFontSize(-1)">A-</button> <span id="font-size">${fontSize}px</span> <button onclick="window.changeFontSize(1)">A+</button> <button onclick="window.toggleReaderTheme()">üåì</button> <button onclick="window.backToBooks()">‚Üê –ö —Å–ø–∏—Å–∫—É</button> </div> <div id="reader-text" class="reader-text ${readerTheme === 'light' ? 'light' : ''}"></div> <div class="reader-pagination"> <button onclick="window.prevPage()">‚óÄ</button> <span id="page-info">1/1</span> <button onclick="window.nextPage()">‚ñ∂</button> </div> </div> </div> </div> `; document.body.appendChild(modal); document.querySelectorAll('.book-item').forEach(item => { window.core.addManagedListener(item, 'click', () => { openBook(item.dataset.book); }); });}window.openReader = openReader;window.nextPage = nextPage;window.prevPage = prevPage;window.changeFontSize = changeFontSize;window.toggleReaderTheme = toggleReaderTheme;window.backToBooks = backToBooks;
