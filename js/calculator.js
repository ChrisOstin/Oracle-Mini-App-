    let calcMode = 'usd';let usdToRub = 90;function calculate() { const amount = parseFloat(document.getElementById('calc-amount')?.value) || 0; const currentPrice = window.currentMoriPrice || 0.006887; let moriAmount = 0; let valueInUsd = 0; if (calcMode === 'usd') { moriAmount = amount / currentPrice; valueInUsd = amount; } else { const usdAmount = amount / usdToRub; moriAmount = usdAmount / currentPrice; valueInUsd = usdAmount; } document.getElementById('calc-result').textContent = moriAmount.toFixed(2); document.getElementById('calc-value').textContent = valueInUsd.toFixed(2);}export function openCalculator() { const currentPrice = window.currentMoriPrice || 0.006887; const modal = document.createElement('div'); modal.className = 'modal'; modal.id = 'calculator-modal'; modal.innerHTML = ` <div class="modal-content"> <div class="modal-header"> <h2>üßÆ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä MORI</h2> <button class="close-btn" onclick="window.closeModal('calculator')">&times;</button> </div> <div class="modal-body"> <div class="calculator-price"> –¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞: <span id="calc-price">$${currentPrice.toFixed(6)}</span> </div> <div class="calculator-switcher"> <button class="calc-mode-btn ${calcMode === 'usd' ? 'active' : ''}" data-mode="usd">USD</button> <button class="calc-mode-btn ${calcMode === 'rub' ? 'active' : ''}" data-mode="rub">RUB</button> </div> <div class="calculator-input"> <input type="number" id="calc-amount" placeholder="100" value="100"> <span id="calc-currency">${calcMode.toUpperCase()}</span> </div> <button class="calc-btn" id="calculate-btn">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button> <div class="calculator-result"> <div>–í—ã –ø–æ–ª—É—á–∏—Ç–µ: <span id="calc-result">0</span> MORI</div> <div>–°—Ç–æ–∏–º–æ—Å—Ç—å: $<span id="calc-value">0</span></div> </div> </div> </div> `; document.body.appendChild(modal); document.querySelectorAll('.calc-mode-btn').forEach(btn => { window.core.addManagedListener(btn, 'click', () => { document.querySelectorAll('.calc-mode-btn').forEach(b => b.classList.remove('active') ); btn.classList.add('active'); calcMode = btn.dataset.mode; document.getElementById('calc-currency').textContent = calcMode.toUpperCase(); calculate(); }); }); window.core.addManagedListener(document.getElementById('calc-amount'), 'input', calculate); window.core.addManagedListener(document.getElementById('calculate-btn'), 'click', calculate); calculate();}export function updatePrice(price) { window.currentMoriPrice = price; const priceEl = document.getElementById('calc-price'); if (priceEl) { priceEl.textContent = `$${price.toFixed(6)}`; calculate(); }}window.openCalculator = openCalculator;window.updateCalculatorPrice = updatePrice;
