    let currentFilter = 'all';const debouncedSearch = window.utils.debounce(async (query) => { if (!query) return; const resultsDiv = document.getElementById('music-results'); resultsDiv.innerHTML = '<div class="loading">üîç –ü–æ–∏—Å–∫...</div>'; try { const data = await window.API.fetch(`${window.CONFIG.API_URL}/api/music/search?q=${encodeURIComponent(query)}`); if (data.success) { renderResults(data.data); } } catch (error) { resultsDiv.innerHTML = '<div class="error">–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞</div>'; window.utils.showToast('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –º—É–∑—ã–∫–∏', 'error'); }}, 500);function renderResults(data) { const resultsDiv = document.getElementById('music-results'); resultsDiv.innerHTML = ''; if (currentFilter === 'all' || currentFilter === 'yandex') { if (data.yandex?.length) { resultsDiv.innerHTML += '<h4>–Ø–Ω–¥–µ–∫—Å.–ú—É–∑—ã–∫–∞</h4>'; data.yandex.forEach(track => { resultsDiv.innerHTML += ` <div class="music-track"> <div class="track-info"> <div class="track-title">${escapeHtml(track.title)}</div> <div class="track-artist">${escapeHtml(track.artist)}</div> </div> <a href="${track.url}" target="_blank" class="track-btn">üéß</a> </div> `; }); } } if (currentFilter === 'all' || currentFilter === 'deezer') { if (data.deezer?.length) { resultsDiv.innerHTML += '<h4>Deezer</h4>'; data.deezer.forEach(track => { resultsDiv.innerHTML += ` <div class="music-track"> <div class="track-info"> <div class="track-title">${escapeHtml(track.title)}</div> <div class="track-artist">${escapeHtml(track.artist)}</div> </div> <div class="track-actions"> <a href="${track.preview}" target="_blank" class="track-btn preview">‚ñ∂Ô∏è 30—Å</a> <a href="${track.url}" target="_blank" class="track-btn">üîó</a> </div> </div> `; }); } } if (currentFilter === 'all' || currentFilter === 'soundcloud') { if (data.soundcloud?.length) { resultsDiv.innerHTML += '<h4>SoundCloud</h4>'; data.soundcloud.forEach(track => { resultsDiv.innerHTML += ` <div class="music-track"> <div class="track-info"> <div class="track-title">${escapeHtml(track.title)}</div> <div class="track-artist">${escapeHtml(track.artist)}</div> </div> <div class="track-actions"> <a href="${track.preview}" target="_blank" class="track-btn preview">‚ñ∂Ô∏è 30—Å</a> <a href="${track.url}" target="_blank" class="track-btn">üîó</a> </div> </div> `; }); } } if (resultsDiv.innerHTML === '') { resultsDiv.innerHTML = '<div class="error">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>'; }}function escapeHtml(unsafe) { return unsafe .replace(/&/g, "&amp;") .replace(/</g, "&lt;") .replace(/>/g, "&gt;") .replace(/"/g, "&quot;") .replace(/'/g, "&#039;");}export function render(container) { container.innerHTML = ` <div class="music-screen"> <div class="search-box"> <input type="text" id="music-search" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç—Ä–µ–∫–∞ –∏–ª–∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å..."> <button id="music-search-btn">üîç</button> </div> <div class="music-filters"> <button class="filter-btn active" data-filter="all">–í—Å–µ</button> <button class="filter-btn" data-filter="yandex">–Ø–Ω–¥–µ–∫—Å</button> <button class="filter-btn" data-filter="deezer">Deezer</button> <button class="filter-btn" data-filter="soundcloud">SoundCloud</button> </div> <div id="music-results" class="music-results"></div> </div> `; const searchInput = document.getElementById('music-search'); const searchBtn = document.getElementById('music-search-btn'); window.core.addManagedListener(searchInput, 'input', (e) => { debouncedSearch(e.target.value); }); window.core.addManagedListener(searchBtn, 'click', () => { debouncedSearch(searchInput.value); }); document.querySelectorAll('.filter-btn').forEach(btn => { window.core.addManagedListener(btn, 'click', (e) => { document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active') ); e.target.classList.add('active'); currentFilter = e.target.dataset.filter; if (searchInput.value) { debouncedSearch(searchInput.value); } }); });}
