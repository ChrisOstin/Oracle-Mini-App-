    const MASTER_PASSWORD = 'MORIFAMILY';let users = JSON.parse(localStorage.getItem('oracle_users')) || {};function checkMasterPassword() { const password = document.getElementById('master-password').value; const errorEl = document.getElementById('login-error'); if (password === MASTER_PASSWORD) { document.getElementById('login-form').classList.add('hidden'); document.getElementById('register-form').classList.remove('hidden'); errorEl.classList.add('hidden'); } else { errorEl.textContent = 'âŒ ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ'; errorEl.classList.remove('hidden'); }}function backToLogin() { document.getElementById('register-form').classList.add('hidden'); document.getElementById('login-form').classList.remove('hidden'); document.getElementById('master-password').value = '';}let selectedAvatar = 'ðŸ‘¤';function selectAvatar(avatar) { selectedAvatar = avatar; document.querySelectorAll('.avatar-option').forEach(el => { el.classList.remove('selected'); }); event.target.classList.add('selected');}function registerUser() { const username = document.getElementById('reg-username').value.trim(); const errorEl = document.getElementById('register-error'); if (!username) { errorEl.textContent = 'âŒ Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð¸Ð¼Ñ'; errorEl.classList.remove('hidden'); return; } if (users[username]) { errorEl.textContent = 'âŒ ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ ÑƒÐ¶Ðµ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚'; errorEl.classList.remove('hidden'); return; } users[username] = { avatar: selectedAvatar, stats: { mori: 0, staking: 0, books: 0 }, stakes: [], booksRead: [], created: new Date().toISOString() }; localStorage.setItem('oracle_users', JSON.stringify(users)); window.currentUser = { name: username, avatar: selectedAvatar, stats: users[username].stats, stakes: users[username].stakes, booksRead: users[username].booksRead }; localStorage.setItem('oracle_user', JSON.stringify(window.currentUser)); document.getElementById('auth-screen').classList.remove('active'); document.getElementById('app-screen').classList.remove('hidden'); showToast(`ðŸ‘‹ Ð”Ð¾Ð±Ñ€Ð¾ Ð¿Ð¾Ð¶Ð°Ð»Ð¾Ð²Ð°Ñ‚ÑŒ, ${username}!`); if (typeof updateProfileUI === 'function') { updateProfileUI(); }}function autoLogin() { const saved = localStorage.getItem('oracle_user'); if (saved) { window.currentUser = JSON.parse(saved); document.getElementById('auth-screen').classList.remove('active'); document.getElementById('app-screen').classList.remove('hidden'); showToast(`ðŸ‘‹ Ð¡ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰ÐµÐ½Ð¸ÐµÐ¼, ${window.currentUser.name}!`); return true; } return false;}function logout() { window.currentUser = null; localStorage.removeItem('oracle_user'); document.getElementById('app-screen').classList.add('hidden'); document.getElementById('auth-screen').classList.add('active'); document.getElementById('login-form').classList.remove('hidden'); document.getElementById('register-form').classList.add('hidden'); showToast('ðŸ‘‹ Ð”Ð¾ ÑÐ²Ð¸Ð´Ð°Ð½Ð¸Ñ!');}document.addEventListener('DOMContentLoaded', () => { if (!autoLogin()) { document.getElementById('auth-screen').classList.add('active'); }});
